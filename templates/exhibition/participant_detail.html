{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}
{% load cache %}
{% load thumbnail %}

{% cache 2592000 participant parent_link object.id %}

{% block header %}
	<h1>{{ object.name }}</h1>
	{% if object.excerpt %}<p class="person-excerpt excerpt">{{object.excerpt}}</p>{% endif %}
{% endblock header %}

{% block svg_icons %}
	{{ block.super }}
{% endblock %}

{% block site_title %}
{{ block.super }}
<a href="{% if request.META.HTTP_REFERER %}{{request.META.HTTP_REFERER}}{% else %}/{{parent_link}}/{% endif %}" class="back-link" onclick="{% if request.META.HTTP_REFERER %}javascript:history.back(); return false;{% endif %}"><svg class="icon arrow-icon"><use xlink:href="#arrow-icon"></use></svg>&nbsp;Назад</a>
{% endblock site_title %}


{% block content %}

<div class="content">

	<div class="person-details-block">
		{% if object.logo %}
		<div class="logo {{parent_link}}-logo">
			{% thumbnail object.logo "300x300" as logo %}
				<img src="{{ logo.url }}">
			{% empty %}
				<img src="{% get_media_prefix %}no-image.png">
			{% endthumbnail %}
		</div>
		{% endif %}
		<div class="person-description my-3">{{ object.description|safe }}</div>
		<div class="meta">
			{% for name, label, value, link in object %}
				{% if value and label %}
				<div class="person-details-item">
					<span>{% if link %}<a href="{{link}}" target="_blank">{{ value }}</a>{% else %}{{ value }}{% endif %}</span>
				</div>
				{% endif %}

				{% if not label and link %}
				<div class="person-details-icon social-link my-2 mr-2">
					<a href="{{ link }}" target="_blank"><svg class="icon {{name}}"><use xlink:href="#logo-{{name}}"></use></svg></a>
				</div>
				{% endif %}
			{% endfor %}
		</div>

		{% if winners_list %}
		<section class="participant-awards my-5">
			<h2>Победы в номинациях:</h2>
			<ol class="winners-list my-2">
			{% for item in winners_list %}
				<li><a href="{% url 'winner-project-detail-url' item.exh_year item.slug %}">{{ item.title }}, {{ item.exh_year }}</a></li>
			{% endfor %}
			</ol>
		</section>
		{% endif %}

		{% if object_list %}
		<section class="participant-projects my-5">
			<h2>Работы участника:</h2>
			<div class="projects-list grid my-2">
				{% for e in object_list %}

				{% if e.images.first %}
				<a id="project-{{e.id}}" class="grid-cell" href="{{ e.get_absolute_url }}">
					<figure>
						{% thumbnail e.images.first.file "320" crop="center" as xs %}
						{% thumbnail e.images.first.file "576" crop="center" as sm %}
						<img class="project-cover"
							src="{{ xs.url }}"
							srcset="{{ xs.url }} {{ xs.x }}w, {{ sm.url }} {{ sm.x }}w">
						{% endthumbnail %}
						{% endthumbnail %}
						<figcaption class="img-title centered">
							<h3 class="project-title">{{ e.title }}<span>{{ e.exh_year }}</span></h3>
						</figcaption>
					</figure>
				</a>
				{% else %}
					<h3 class="project-title">{{ e.title }}<span>{{ e.exh_year }}</span></h3>
				{% endif %}

				{% endfor %}
			</div>
		</section>
		{% endif %}

	</div>
</div>

{% endblock content %}

{% endcache %}